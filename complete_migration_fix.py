#!/usr/bin/env python3
"""
–ü–æ–ª–Ω–∞—è —Ñ–∏–∫—Å–∞—Ü–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏:
1. –î–æ–±–∞–≤–ª—è–µ—Ç short_id –≤—Å–µ–º –∫–Ω–æ–ø–∫–∞–º
2. –û–±–Ω–æ–≤–ª—è–µ—Ç pages_json –¥–ª—è –¢–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏–∏
3. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç parent_id –¥–ª—è –≤—Å–µ—Ö –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫
"""

import asyncio
import database
from database import init_db, generate_short_id
import json

async def main():
    print("=" * 60)
    print("–ü–û–õ–ù–ê–Ø –§–ò–ö–°–ê–¶–ò–Ø –ú–ò–ì–†–ê–¶–ò–ò")
    print("=" * 60)

    await init_db()

    async with database.pool.acquire() as conn:
        # –®–ê–ì 1: –î–æ–±–∞–≤–∏—Ç—å short_id –≤—Å–µ–º –∫–Ω–æ–ø–∫–∞–º
        print("\nüìù –®–ê–ì 1: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ short_id")
        buttons_without_short = await conn.fetch("""
            SELECT button_id FROM button_content
            WHERE short_id IS NULL OR short_id = ''
        """)

        if buttons_without_short:
            print(f"   –ù–∞–π–¥–µ–Ω–æ {len(buttons_without_short)} –∫–Ω–æ–ø–æ–∫ –±–µ–∑ short_id")
            for btn in buttons_without_short:
                button_id = btn['button_id']
                short_id = generate_short_id(button_id)

                await conn.execute("""
                    UPDATE button_content
                    SET short_id = $1
                    WHERE button_id = $2
                """, short_id, button_id)

                print(f"   ‚úì {button_id[:40]}... -> {short_id}")
            print(f"   ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ {len(buttons_without_short)} short_id")
        else:
            print(f"   ‚úÖ –í—Å–µ –∫–Ω–æ–ø–∫–∏ —É–∂–µ –∏–º–µ—é—Ç short_id")

        # –®–ê–ì 2: –û–±–Ω–æ–≤–∏—Ç—å –¢–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—é —Å pages_json
        print("\nüìñ –®–ê–ì 2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¢–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏–∏")

        # –î–∞–Ω–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏–∏ —Å 6 —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏
        terminology_pages = [
            {"text": "<b>–£—Ä–æ–∫ –¢–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏–∏ - —Å–ø–∏—Å–æ–∫ —Ç–µ—Ä–º–∏–Ω–æ–≤ –∏ –∞–±–±—Ä–µ–≤–∏–∞—Ç—É—Ä, –∫–æ—Ç–æ—Ä—ã–µ –∞–¥–º–∏–Ω—ã –∏ –Ω–µ —Ç–æ–ª—å–∫–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –≤ –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω–æ–π —Ç–µ–ª–µ–≥—Ä–∞–º–æ–≤—Å–∫–æ–π –∂–∏–∑–Ω–∏.</b>\n\n<b>–°–ø–∏—Å–æ–∫ —Ç–µ—Ä–º–∏–Ω–æ–≤/–∞–±–±—Ä–µ–≤–∏–∞—Ç—É—Ä</b>\n\n‚Ä¢ <b>–ü–°–ò–•–û</b> - –ø—Å–∏—Ö–æ–ª–æ–≥–∏—è [—Ç–µ–º–∞—Ç–∏–∫–∞]\n‚Ä¢ <b>–°–ú</b> - —Å–∞–º–æ—Ä–∞–∑–≤–∏—Ç–∏–µ [—Ç–µ–º–∞—Ç–∏–∫–∞]\n‚Ä¢ <b>–¶–ê</b> - —Ü–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è\n‚Ä¢ <b>–ñ–¶–ê</b> - –∂–µ–Ω—Å–∫–∞—è —Ü–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è\n‚Ä¢ <b>–ú–¶–ê</b> - –º—É–∂—Å–∫–∞—è —Ü–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è\n‚Ä¢ <b>–°–¶–ê</b> - —Å–º–µ—à–∞–Ω–Ω–∞—è –¶–ê\n‚Ä¢ <b>–ü–î–ü</b> - –ø–æ–¥–ø–∏—Å—á–∏–∫-(–∏)\n‚Ä¢ <b>–ê–£–î–ò–¢</b> - –∞—É–¥–∏—Ç–æ—Ä–∏—è –∫–∞–Ω–∞–ª–∞/–±–æ—Ç–∞ –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ\n‚Ä¢ <b>–õ–ò–ù–ö</b> - —Å—Å—ã–ª–∫–∞ –Ω–∞ –∫–∞–Ω–∞–ª/–ø—Ä–æ—Ñ–∏–ª—å\n‚Ä¢ <b>–û–¢–ö–†–´–¢–ê–Ø –°–°–´–õ–ö–ê</b> - –æ–Ω–∞ –∂–µ –ª–∏–Ω–∫, —Å—Å—ã–ª–∫–∞ –Ω–∞ –∫–∞–Ω–∞–ª –±–µ–∑ –∑–∞—è–≤–∫–∏ –Ω–∞ –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è\n‚Ä¢ <b>–°–†–ú/–¶–ü–ú/–°–ü–ú</b> - —Ü–µ–Ω–∞ –∑–∞ 1.000 –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤, —É –∫–∞–∂–¥–æ–π —Ç–µ–º–∞—Ç–∏–∫–∏ —Å–≤–æ—è —Ü–µ–Ω–∞.\n‚Ä¢ <b>–õ–°</b> - –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è."},
            {"text": "<b>–°–ø–∏—Å–æ–∫ —Ç–µ—Ä–º–∏–Ω–æ–≤/–∞–±–±—Ä–µ–≤–∏–∞—Ç—É—Ä</b>\n\n‚Ä¢ <b>–û–•–í–ê–¢–´ (–ì–õ–ê–ó–ê)</b> - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ –Ω–∞ –ø–æ—Å—Ç–µ. –ú–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤ –ø—Ä–∞–≤–æ–º –Ω–∏–∂–µ–º —É–≥–ª—É –≤ –∫–∞–Ω–∞–ª–µ.\n‚Ä¢ <b>–°–¢–ê–¢–ê</b> - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞.\n‚Ä¢ <b>–°–¢–ê–¢–ê +++</b> - –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–∏—Ä–æ—Å—Ç –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ –∑–∞ –¥–µ–Ω—å/–Ω–µ–¥–µ–ª—é/–º–µ—Å—è—Ü\n‚Ä¢ <b>–¢–ú</b> - —Å–µ—Ä–≤–∏—Å –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ Telemetr\n‚Ä¢ <b>–¢–ì–°–¢–ê–¢</b> - —Å–µ—Ä–≤–∏—Å –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ TGStat\n‚Ä¢ <b>–ì–ê–†–¨</b> - –º–µ—Å—Ç–æ –∫–æ—Ç–æ—Ä–æ–µ —Å—Ä–æ—á–Ω–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–∫—Ä—ã—Ç—å —Ä–µ–∫–ª–∞–º–Ω—ã–º –ø–æ—Å—Ç–æ–º, –æ–±—ã—á–Ω–æ –ø—Ä–æ–¥–∞—é—Ç —Å –∫–∞–∫–æ–π-–ª–∏–±–æ –ø–ª—é—à–∫–æ–π (–¥–æ–ø.–ª–µ–Ω—Ç–∞ –∏–ª–∏ —Å–∫–∏–¥–∫–∞).\n‚Ä¢ <b>–¢–ì –¢–†–ê–§</b> - —Ç–∏–ø —Ç—Ä–∞—Ñ–∏–∫–∞, –∫–∞–Ω–∞–ª –∫–æ—Ç–æ—Ä—ã–π –ø–æ–ª—É—á–∞–µ—Ç –∞—É–¥–∏—Ç–æ—Ä–∏—é –∏–º–µ–Ω–Ω–æ —Å –¢–µ–ª–µ–≥—Ä–∞–º–∞, –ø—É—Ç–µ–º –ø—Ä–∏–æ–±—Ä–µ—Ç–µ–Ω–∏—è —Ä–µ–∫–ª–∞–º—ã –≤ —Å–º–µ–∂–Ω—ã—Ö –¢–ì –∫–∞–Ω–∞–ª–∞—Ö, –ª–∏–±–æ –≤ –±–æ—Ç–∞—Ö (—Ä–∞—Å—Å—ã–ª–∫–∞, –ø—Ä–∏–≤–µ—Ç—Å–≤–∏–µ)."},
            {"text": "<b>–°–ø–∏—Å–æ–∫ —Ç–µ—Ä–º–∏–Ω–æ–≤/–∞–±–±—Ä–µ–≤–∏–∞—Ç—É—Ä</b>\n\n‚Ä¢ <b>1/24</b> - 1 —á–∞—Å —Ç–æ–ø–∞ –∏ 24 –ª–µ–Ω—Ç—ã (–º–æ–∂–µ—Ç –≤–∞—Ä—å–∏—Ä–æ–≤–∞—Ç—å—Å—è)\n‚Ä¢ <b>–¢–û–ü</b> - –≤—Ä–µ–º—è, –∫–æ—Ç–æ—Ä–æ–µ —Ä–µ–∫–ª–∞–º–∞ –≤–∏—Å–∏—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–º –ø–æ—Å—Ç–æ–º\n‚Ä¢ <b>–õ–ï–ù–¢–ê</b> - –≤—Ä–µ–º—è —á–µ—Ä–µ–∑ –∫–æ—Ç–æ—Ä–æ–µ —É–¥–∞–ª—è–µ—Ç—Å—è —Ä–µ–∫–ª–∞–º–∞\n‚Ä¢ <b>–ü–†–Ø–ú–û–ô –ü–û–°–¢</b> - —Ä–µ–∫–ª–∞–º–Ω—ã–π –ø–æ—Å—Ç, –æ–ø–∏—Å—ã–≤–∞—é—â–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç –∫–∞–Ω–∞–ª–∞\n‚Ä¢ <b>–ö–õ–ò–ö–ë–ï–ô–¢(–ö–õ–ò–ö)</b> - –ø–æ—Å—Ç, –∑–∞–≤–ª–µ–∫–∞—é—â–∏–π —á–µ–ª–æ–≤–µ–∫–∞ –≤ –∫–∞–Ω–∞–ª –ø—É—Ç—ë–º –æ–ø—Ä–æ—Å–∞, —Ä–∞—Å—Å–∫–∞–∑–∞ –∏—Å—Ç–æ—Ä–∏–∏ –∏ —Ä–µ–∑–∫–æ–≥–æ –µ—ë –æ–±—Ä—ã–≤–∞ (–ø–æ—Å—Ç-–ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ)\n‚Ä¢ <b>–ü–†–û–ö–õ–ê–î–ö–ê/–ü–ï–†–ï–•–û–î–ù–ò–ö</b> - –ø—É–±–ª–∏—á–Ω—ã–π –∫–∞–Ω–∞–ª, –≤ –∫–æ—Ç–æ—Ä–æ–º –≤—ã–ª–æ–∂–µ–Ω–∞ –ø—Ä–∏–≤–∞—Ç–Ω–∞—è —Å—Å—ã–ª–∫–∞\n‚Ä¢ <b>–û–¢–õ–û–ñ–ö–ê/–û–¢–õ–û–ì–ê</b> -  –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è –ø–æ—Å—Ç–∞ –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è –∏ –¥–∞—Ç—É\n‚Ä¢ <b>–°–ü–ê–ú</b> -  –≤–∏–¥ –Ω–∞–∫–∞–∑–∞–Ω–∏—è –∏–∑-–∑–∞ –∂–∞–ª–æ–± –Ω–∞ –≤–∞—Å, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø—Ä–µ—â–∞–µ—Ç –≤–∞–º –ø–∏—Å–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç —É –≤–∞—Å –≤ –∫–æ–Ω—Ç–∞–∫—Ç–∞—Ö. –ï—â—ë —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç —Ä–∞—Å—Å—ã–ª–∫—É –≤ –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤—Å—è–∫–æ–π —Ä–µ–∫–ª–∞–º—ã –∏ –ø—Ä–æ—á–µ–≥–æ."},
            {"text": "<b>–°–ø–∏—Å–æ–∫ —Ç–µ—Ä–º–∏–Ω–æ–≤/–∞–±–±—Ä–µ–≤–∏–∞—Ç—É—Ä</b>\n\n‚Ä¢ <b>–î–ï–ú–ü–ò–ù–ì</b> - –∑–∞–Ω–∏–∂–µ–Ω–∏–µ —Ü–µ–Ω—ã –Ω–∞ —Ä–µ–∫–ª–∞–º—É —Å–∏–ª—å–Ω–æ –Ω–∏–∂–µ —Ä—ã–Ω–∫–∞.\n‚Ä¢ <b>–ì–ê–†–ê–ù–¢</b> -  –ø–æ—Å—Ä–µ–¥–Ω–∏–∫ –≤ —Å–¥–µ–ª–∫–µ –ø–æ –ø–æ–∫—É–ø–∫–µ/–ø—Ä–æ–¥–∞–∂–∏ –∫–∞–Ω–∞–ª–∞, –∫–æ—Ç–æ—Ä—ã–π –¥–∞–µ—Ç –≥–∞—Ä–∞–Ω—Ç–∏—é –Ω–∞ —Ç–æ, —á—Ç–æ –Ω–∏–∫—Ç–æ –Ω–∏–∫–æ–≥–æ –Ω–µ –æ–±–º–∞–Ω–µ—Ç\n‚Ä¢ <b>–ì–ê–†–ê–ù–¢ –ü–î–ü</b> - —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ü–µ–Ω–∞ –∑–∞ –ø–æ–¥–ø–∏—Å—á–∏–∫–∞ —Å –∫—É–ø–ª–µ–Ω–Ω–æ–π —Ä–µ–∫–ª–∞–º—ã. –ù–∞–ø—Ä–∏–º–µ—Ä: –≤—ã –∫—É–ø–∏–ª–∏ —Ä–µ–∫–ª–∞–º—É –∑–∞ 1000‚ÇΩ —Å –≥–∞—Ä–∞–Ω—Ç–æ–º –≤ 10‚ÇΩ, –∑–Ω–∞—á–∏—Ç –≤–∞–º –¥–æ–ª–∂–Ω–æ –ø—Ä–∏–π—Ç–∏ 100 –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ —Å —ç—Ç–æ–π —Ä–µ–∫–ª–∞–º—ã, –∏–Ω–∞—á–µ –≤–∞–º –æ–±—è–∑–∞–Ω—É –±—É–¥—É—Ç –¥–æ–≤–µ—Å—Ç–∏ –æ—Ç–¥–∞—á—É –¥–æ 100 –ø–¥–ø –∏–ª–∏ –≤–µ—Ä–Ω—É—Ç—å —Ä–∞–∑–Ω–∏—Ü—É\n‚Ä¢ <b>–ì–ï–û</b> -  —Å—Ç—Ä–∞–Ω–∞ –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è –∞—É–¥–∏—Ç–æ—Ä–∏–∏ –∫–∞–Ω–∞–ª–∞. –£ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –∫–∞–Ω–∞–ª–æ–≤ –≥–µ–æ –ø–∏—à–µ—Ç—Å—è –Ω–∞ –¢–µ–ª–µ–º–µ—Ç—Ä–µ. –ì–µ–æ –≤—Å–µ–≥–¥–∞ –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ –∫–∞–Ω–∞–ª–∞, –Ω–æ –¥–æ—Å—Ç—É–ø–Ω–∞ –æ–Ω–∞ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—É\n‚Ä¢ <b>–ü–û–î–ë–û–†–ö–ê</b> - —Å–ø–∏—Å–æ–∫ –∏–∑ 3-8 –∫–∞–Ω–∞–ª–æ–≤ –ø–æ —Å—Ö–æ–∂–µ–π —Ç–µ–º–∞—Ç–∏–∫–µ\n‚Ä¢ <b>–ú–ï–ì–ê</b> -  –ö—Ä—É–ø–Ω–∞—è –ø–æ–¥–±–æ—Ä–∫–∞ –∫–∞–Ω–∞–ª–æ–≤ —Ä–∞–∑–Ω–æ–π —Ç–µ–º–∞—Ç–∏–∫–∏"},
            {"text": "<b>–°–ø–∏—Å–æ–∫ —Ç–µ—Ä–º–∏–Ω–æ–≤/–∞–±–±—Ä–µ–≤–∏–∞—Ç—É—Ä</b>\n\n‚Ä¢ <b>–û–ü</b> - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –ø—Ä–∞–≤–∏–ª–æ –≤ –±–æ—Ç–∞—Ö (—á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –±–æ—Ç–æ–º –Ω—É–∂–Ω–æ –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ù–ù–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–Ω–∞–ª–æ–≤.\n‚Ä¢ <b>–ö–†–ï–ê–¢–ò–í/–ö–†–ï–û</b> -  —Ä–µ–∫–ª–∞–º–Ω—ã–π –ø–æ—Å—Ç\n‚Ä¢ <b>–û–¢–í–ï–¢–ö–ê</b> -  –æ—Ç–≤–µ—Ç –Ω–∞ —Ä–µ–∫–ª–∞–º–Ω—ã–π –ø–æ—Å—Ç —Ñ—Ä–∞–∑–æ–π –∏/–∏–ª–∏ —Å—Å—ã–ª–∫–æ–π –Ω–∞ —Ä–µ–∫–ª–∞–º–∏—Ä—É–µ–º—ã–π –∫–∞–Ω–∞–ª\n‚Ä¢ <b>–í–ü</b> -  –≤–∑–∞–∏–º–Ω—ã–π –ø–∏–∞—Ä, –∞–¥–º–∏–Ω—ã —Ä–µ–∫–ª–∞–º–∏—Ä—É—é—Ç –∫–∞–Ω–∞–ª—ã –¥—Ä—É–≥ –¥—Ä—É–≥–∞ (—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ: \"–î–∞–≤–∞–π –í–ü –ø–æ—Å—Ç–∞–≤–∏–º\")\n‚Ä¢ <b>–†–ï–ò–ù–í–ï–°–¢</b> - –≤–ª–æ–∂–µ–Ω–∏–µ —á–∞—Å—Ç–∏ —Å—Ä–µ–¥—Å—Ç–≤ —Å –ø—Ä–∏–±—ã–ª–∏ –æ–±—Ä–∞—Ç–Ω–æ –≤ –∫–∞–Ω–∞–ª (—Ä–µ–∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)."},
            {"text": "<b>–°–ø–∏—Å–æ–∫ —Ç–µ—Ä–º–∏–Ω–æ–≤/–∞–±–±—Ä–µ–≤–∏–∞—Ç—É—Ä</b>\n\n‚Ä¢ <b>–§–£–õ–õ –†–ï–ò–ù–í–ï–°–¢, –§–£–õ–õ</b> - –ø–æ–ª–Ω–æ–µ (100%) —Ä–µ–∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤ –≤ –∑–∞–∫—É–ø–∫—É —Ä–µ–∫–ª–∞–º—ã –Ω–∞ –∫–∞–Ω–∞–ª\n(—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ: \"–†–∞—Å—Å–º–æ—Ç—Ä—é —Ç–æ–ª—å–∫–æ –∫–∞–Ω–∞–ª—ã –Ω–∞ —Ñ—É–ª–ª —Ä–µ–∏–Ω–≤–µ—Å—Ç–µ\", \"–ö—É–ø–ª—é –ø–æ–¥ —Ñ—É–ª–ª\" (–ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ—Ç—Å—è —Ñ—É–ª–ª —Ä–µ–∏–Ω–≤–µ—Å—Ç)\n‚Ä¢ <b>–†–ï–ò–ù–í–ï–°–¢ –§–£–õ–õ+, –§–£–õ–õ+</b> - —Ä–µ–∏–Ω–≤–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è –ë–û–õ–¨–®–ï 100% —Å—Ä–µ–¥—Å—Ç–≤, –∑–∞—Ä–∞–±–æ—Ç–Ω–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–º —Å –ø—Ä–æ–¥–∞–∂–∏ —Ä–µ–∫–ª–∞–º—ã\n(—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ: \"–ö—É–ø–ª—é —Ä–µ–∫–ª–∞–º—É —Ñ—É–ª–ª+\")\n‚Ä¢ <b>–£–ë–¢</b> - —É—Å–ª–æ–≤–Ω–æ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ç—Ä–∞—Ñ–∏–∫. –í–∏–¥ —Ç—Ä–∞—Ñ–∏–∫–∞, –∫–æ—Ç–æ—Ä—ã–π –ø–µ—Ä–µ–≥–æ–Ω—è–µ—Ç—Å—è —Å –¥—Ä—É–≥–∏—Ö –ø–ª–æ—â–∞–¥–æ–∫ –≤ —Ç–µ–ª–µ–≥—Ä–∞–º: —é—Ç—É–±, –∏–Ω—Å—Ç, —Ç–∏–∫-—Ç–æ–∫\n\n<b>–≠—Ç–æ –∫–æ–Ω–µ—Ü. –Ω–∞–¥–µ—é—Å—å —É –º–µ–Ω—è –ø–æ–ª—É—á–∏–ª–æ—Å—å –≤–Ω–µ—Å—Ç–∏ —è—Å–Ω–æ—Å—Ç–∏, —Å–ø–∞—Å–∏–±–æ —Ç–µ–±–µ –∑–∞ –ø—Ä–æ—á—Ç–µ–Ω–∏–µ ü§ù</b>"}
        ]

        button_id = "üìñ –£—Ä–æ–∫ –¢–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏–∏"
        pages_json = json.dumps(terminology_pages)
        first_page_content = terminology_pages[0]['text']
        short_id = generate_short_id(button_id)

        await conn.execute("""
            UPDATE button_content
            SET content = $1,
                pages_json = $2,
                short_id = $3
            WHERE button_id = $4
        """, first_page_content, pages_json, short_id, button_id)

        print(f"   ‚úì –û–±–Ω–æ–≤–ª–µ–Ω–∞ –¢–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è")
        print(f"   ‚úì –î–æ–±–∞–≤–ª–µ–Ω–æ {len(terminology_pages)} —Å—Ç—Ä–∞–Ω–∏—Ü")
        print(f"   ‚úì Short ID: {short_id}")

        # –®–ê–ì 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫
        print("\nüîç –®–ê–ì 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫")

        problem_checks = [
            ("üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å–∞–π—Ç—ã:–ù–∞–ø–∏—Å–∞—Ç—å —Å—Ç–∞—Ç—å—é", "üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å–∞–π—Ç—ã"),
            ("üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å–∞–π—Ç—ã:–¢–µ–ª–µ–≥—Ä–∞–º", "üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å–∞–π—Ç—ã"),
            ("ü§ñ –†–∞–∑–ª–∏—á–Ω—ã–µ –±–æ—Ç—ã:–î–ª—è —á–∞—Ç–æ–≤", "ü§ñ –†–∞–∑–ª–∏—á–Ω—ã–µ –±–æ—Ç—ã"),
            ("üõ° Garant Checker:‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è", "üõ° Garant Checker"),
            ("üõ° Garant Checker:‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:üì∫ –ë–ò–†–ñ–ò –ö–ê–ù–ê–õ–û–í", "üõ° Garant Checker:‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è"),
        ]

        all_ok = True
        for button_id, expected_parent in problem_checks:
            btn = await conn.fetchrow("""
                SELECT button_id, parent_id, short_id
                FROM button_content
                WHERE button_id = $1
            """, button_id)

            if btn:
                if btn['parent_id'] == expected_parent and btn['short_id']:
                    print(f"   ‚úÖ {button_id[:40]}...")
                else:
                    print(f"   ‚ùå {button_id[:40]}...")
                    print(f"      parent_id: {btn['parent_id']} (–æ–∂–∏–¥–∞–µ—Ç—Å—è: {expected_parent})")
                    print(f"      short_id: {btn['short_id']}")
                    all_ok = False
            else:
                print(f"   ‚ùå {button_id[:40]}... - –ù–ï –ù–ê–ô–î–ï–ù–ê")
                all_ok = False

        # –§–ò–ù–ê–õ–¨–ù–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê
        print("\n" + "=" * 60)
        print("–°–¢–ê–¢–ò–°–¢–ò–ö–ê:")
        total = await conn.fetchval("SELECT COUNT(*) FROM button_content")
        with_short = await conn.fetchval("SELECT COUNT(*) FROM button_content WHERE short_id IS NOT NULL")
        with_parent = await conn.fetchval("SELECT COUNT(*) FROM button_content WHERE parent_id IS NOT NULL")
        with_pages = await conn.fetchval("SELECT COUNT(*) FROM button_content WHERE pages_json IS NOT NULL")

        print(f"  –í—Å–µ–≥–æ –∫–Ω–æ–ø–æ–∫: {total}")
        print(f"  –° short_id: {with_short} {'‚úÖ' if with_short == total else '‚ùå'}")
        print(f"  –° parent_id: {with_parent}")
        print(f"  –° pages_json: {with_pages} {'‚úÖ' if with_pages > 0 else '‚ùå'}")

        print("=" * 60)

        if with_short == total and with_pages > 0:
            print("\nüéâ –í–°–Å –ì–û–¢–û–í–û! –ú–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –±–æ—Ç–∞: py bot.py")
        else:
            if with_short < total:
                print(f"\n‚ö†Ô∏è  {total - with_short} –∫–Ω–æ–ø–æ–∫ –±–µ–∑ short_id")
            if not all_ok:
                print(f"\n‚ö†Ô∏è  –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∫–Ω–æ–ø–∫–∏ –∏–º–µ—é—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π parent_id")
                print(f"     –ó–∞–ø—É—Å—Ç–∏—Ç–µ: py migrate_full_menu.py")

if __name__ == "__main__":
    asyncio.run(main())
